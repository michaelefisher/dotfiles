## aliases
if [ -f ~/.aliases ]; then
    source ~/.aliases
fi

# Register autoloads
fpath=($HOME/.zsh/autoloads $fpath)
for f in $(ls $HOME/.zsh/autoloads); do
    autoload $f
done

export HISTTIMEFORMAT='%d/%m/%y %T '
if [[ "$TERM_PROGRAM" == 'vscode' ]]; then
	export EDITOR="code --wait"
else
	export EDITOR="vim"
fi

export GIT="$HOME/git"
function dateu() {
  date --date="@$1"
}

function timestamp() {
  date -j -f "%b %d %T %Z %Y" "${1}" "+%s"
}

# z.sh
z() { . "/Users/michaelfisher/bin/z/z.sh" "$@" ; }

bindkey -v
bindkey '^R' history-incremental-search-backward
bindkey "^A" vi-beginning-of-line
bindkey "^E" vi-end-of-line


# Export PATH here
export PATH="/usr/local/sbin:/usr/local/opt/openjdk/bin:$HOME/.pyenv/shims/:$HOME/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/bin:$HOME/bin:$HOME/google-cloud-sdk/bin:$HOME/codeql-home/codeql:$PATH"


{{ if eq .chezmoi.os "darwin" }}
export LDFLAGS="-L/usr/local/opt/bzip2/lib -L/usr/local/opt/zlib/lib -L/usr/local/opt/openssl@1.1/lib"
export CFLAGS="-I/usr/local/opt/bzip2/include -I/usr/local/opt/zlib/include -I/usr/local/opt/openssl@1.1/include -I$(xcrun --show-sdk-path)/usr/include -Wno-implicit-function-declaration"
{{ end }}
# The next line updates PATH for the Google Cloud SDK.
if [ -f "${HOME}/google-cloud-sdk/path.zsh.inc" ]; then . "${HOME}/google-cloud-sdk/path.zsh.inc"; fi

# The next line enables shell command completion for gcloud.
if [ -f "${HOME}/google-cloud-sdk/completion.zsh.inc" ]; then . "${HOME}/google-cloud-sdk/completion.zsh.inc"; fi

# git
fixup() { git commit -m "noop" --no-verify --allow-empty && git rebase -i "$@" ; }
ac() { test "$@" != "" && git add . && git commit -m "$@" --no-verify ; }
restore_all() { git st -s | cut -d' ' -f2 | xargs -L1 git restore ; }

# urldecode
urldecode() { : "${*//+/ }"; echo -e "${_//%/\\x}"; }

# view octal
octal() { stat -f "%OLp" $1; }

# Activate gcloud configs
activate() { gcloud config configurations activate "$@" ; }

# motd supervision
if [[ -f /home/fisher/git/tinymotd/data/motd ]]; then
    cat /home/fisher/git/tinymotd/data/motd
fi
# k8s
creds() {
	gcloud container clusters get-credentials "$1" --zone us-central1-a --project "$2"
}

if [[ ! -f "$HOME/.cache/starship.zsh" || /usr/local/bin/starship -nt "$HOME/.cache/starship.zsh" ]]; then
	starship init zsh > "$HOME/.cache/starship.zsh"
fi
source "$HOME/.cache/starship.zsh"


merge() { gh pr merge "$1" --admin }

me() { if jq -V &>/dev/null; then curl -s ifconfig.me/all.json "$@" | jq; else printf "Must have jq installed!\n" && return 0; fi; }

reset() { if [ "$#" -lt 2 ]; then echo "Usage: reset branch-name file1 [file2 ... fileN]"; return 1; fi; local branch_name=$1; shift; for file in "$@"; do git checkout "$branch_name" -- "$file"; if [ $? -ne 0 ]; then echo "Failed to reset $file"; return 1; fi; done; git status; echo -n "Do you want to commit the changes? (yes/no) "; read confirmation; if [[ "$confirmation" == "yes" ]]; then git add "$@"; git commit -m "Reset changes to branch $branch_name" --no-verify; else echo "Changes not committed."; fi; }

squash() {
    if [ "$#" -ne 1 ]; then
        echo "Usage: squash_commits num_commits"
        return 1
    fi
    local num_commits=$1
    echo "The following commits will be squashed:"
    git log -n "$num_commits" --oneline
    echo -n "Do you want to squash these commits? (yes/no) "
    read confirmation
    if [[ "$confirmation" != "yes" ]]; then
        echo "Commit squash aborted."
        return 1
    fi
    git reset --soft HEAD~"$num_commits" &&
    git commit --reuse-message=HEAD@{1}
    if [ $? -eq 0 ]; then
        echo "Commits successfully squashed."
    else
        echo "Failed to squash commits. Please resolve any conflicts and try again."
    fi
}

# Lazy loading handled by autoloads
export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"

export NVM_DIR="$HOME/.nvm"

export PATH="$HOME/.rbenv/bin:$PATH"

# Go
export GO111MODULE=auto

# pnpm
export PNPM_HOME="$HOME/Library/pnpm"
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac

export PATH="/opt/homebrew/opt/openjdk/bin:$PATH"

test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

autoload -Uz compinit
if [[ -n ${ZDOTDIR}/.zcompdump(#qNmh+24) ]]; then
    compinit
else
    compinit -C
fi

